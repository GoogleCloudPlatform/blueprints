# API Activation
apiVersion: serviceusage.cnrm.cloud.google.com/v1beta1
kind: Service
metadata:
  annotations:
    cnrm.cloud.google.com/deletion-policy: "abandon"
    cnrm.cloud.google.com/disable-dependent-services: "false"
    cnrm.cloud.google.com/project-id: my-project-id # {"$kpt-set":"project-id"}
  name: my-project-id-bigquery # {"$kpt-set":"services-bigquery"}
  namespace: projects
spec:
  resourceID: bigquery.googleapis.com
---
# Folder Sink to BQ
apiVersion: logging.cnrm.cloud.google.com/v1beta1
kind: LoggingLogSink
metadata:
  name: my.folder.k8s.name-bqsink # {"$kpt-set":"log-sink-name"}
  namespace: my-namespace # {"$kpt-set":"namespace"}
spec:
  folderRef:
    name: my.folder.k8s.name # {"$kpt-set":"folder-k8s-name"}
  destination:
    bigQueryDatasetRef:
      name: bqlogexportdataset
  includeChildren: true
  filter: "" # {"$kpt-set":"filter"}
---
# BQ Dataset
apiVersion: bigquery.cnrm.cloud.google.com/v1beta1
kind: BigQueryDataset
metadata:
  annotations:
    cnrm.cloud.google.com/delete-contents-on-destroy: "false" # {"$kpt-set":"delete-contents-on-destroy"}
  name: bqlogexportdataset
  namespace: my-namespace # {"$kpt-set":"namespace"}
spec:
  defaultTableExpirationMs: 3600000 # {"$kpt-set":"default-table-expiration-ms"}
  description: "BigQuery audit logs for folder" # {"$kpt-set":"dataset-description"}
  friendlyName: audit-logs # {"$kpt-set":"dataset-name"}
  location: US # {"$kpt-set":"dataset-location"}
