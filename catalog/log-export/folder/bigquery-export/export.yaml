apiVersion: serviceusage.cnrm.cloud.google.com/v1beta1 # API Activation
kind: Service
metadata:
  annotations:
    cnrm.cloud.google.com/blueprint: cnrm/bigquery-export/v0.2.0-alpha.1
    cnrm.cloud.google.com/deletion-policy: abandon
    cnrm.cloud.google.com/disable-dependent-services: "false"
    cnrm.cloud.google.com/project-id: my-project-id # {"$kpt-set":"project-id"}
  name: my-project-id-bigquery # {"$kpt-set":"services-bigquery"}
  namespace: projects
spec:
  resourceID: bigquery.googleapis.com
---
apiVersion: logging.cnrm.cloud.google.com/v1beta1 # Folder Sink to BQ
kind: LoggingLogSink
metadata:
  annotations:
    cnrm.cloud.google.com/blueprint: cnrm/bigquery-export/v0.2.0-alpha.1
  name: my.folder.k8s.name-bqsink # {"$kpt-set":"log-sink-name"}
  namespace: my-namespace # {"$kpt-set":"namespace"}
spec:
  destination:
    bigQueryDatasetRef:
      name: bqlogexportdataset
  filter: "" # {"$kpt-set":"filter"}
  folderRef:
    name: my.folder.k8s.name # {"$kpt-set":"folder-k8s-name"}
  includeChildren: true
---
apiVersion: bigquery.cnrm.cloud.google.com/v1beta1 # BQ Dataset
kind: BigQueryDataset
metadata:
  annotations:
    cnrm.cloud.google.com/blueprint: cnrm/bigquery-export/v0.2.0-alpha.1
    cnrm.cloud.google.com/delete-contents-on-destroy: "false" # {"$kpt-set":"delete-contents-on-destroy"}
  name: bqlogexportdataset
  namespace: my-namespace # {"$kpt-set":"namespace"}
spec:
  defaultTableExpirationMs: 3600000 # {"$kpt-set":"default-table-expiration-ms"}
  description: BigQuery audit logs for folder # {"$kpt-set":"dataset-description"}
  friendlyName: audit-logs # {"$kpt-set":"dataset-name"}
  location: US # {"$kpt-set":"dataset-location"}
